<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>å…«å­—äº”è¡Œ Â· ç§äººç‰ˆï¼ˆJulieï¼‰</title>
<style>
  body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,Apple Color Emoji;max-width:900px;margin:24px auto;padding:0 14px;line-height:1.55}
  h1{font-size:20px;margin:8px 0 4px}
  .sub{color:#666;font-size:13px;margin:0 0 14px}
  .card{border:1px solid #eee;border-radius:12px;padding:14px;margin:12px 0;background:#fff}
  label{display:block;margin:10px 0 6px}
  input,select,button,textarea{width:100%;padding:10px;border:1px solid #ddd;border-radius:10px;font-size:16px}
  button{cursor:pointer}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .muted{color:#777;font-size:13px}
  .mono{font-family:ui-monospace,Menlo,Monaco,Consolas,monospace}
  .pill{display:inline-block;padding:2px 8px;border:1px solid #eee;border-radius:999px;margin-right:6px;font-size:12px}
</style>
<script src="https://cdn.jsdelivr.net/npm/lunar-javascript/lunar.js"></script>
</head>
<body>
<h1>å…«å­—äº”è¡Œ Â· ç§äººç‰ˆï¼ˆJulieï¼‰</h1>
<p class="sub">è¾“å…¥ç”Ÿæ—¥ â†’ ä¸€é”®ç”Ÿæˆå¯å¤åˆ¶çš„<strong>äº”è¡Œè§£è¯´</strong>ã€<strong>æ€§æ ¼</strong>ã€<strong>æ•°å­—å‰å‡¶</strong>ä¸<strong>æ°´æ™¶/å–·é›¾é¦™æ°´/æŒ‚ä»¶å»ºè®®</strong>ï¼ˆå«é¢œè‰²/æ–¹ä½/è´µäººï¼‰</p>

<div class="card">
  <div class="row">
    <div>
      <label>å‘½ä¸»å§“åï¼ˆå¯ç•™ç©ºï¼‰</label>
      <input id="name" placeholder="ä¾‹ï¼šç‹å°æ˜"/>
    </div>
    <div>
      <label>æ€§åˆ«ï¼ˆå¯ç•™ç©ºï¼‰</label>
      <select id="gender">
        <option value="">ä¸å¡«</option><option>ç”·</option><option>å¥³</option>
      </select>
    </div>
  </div>

  <label>å…¬å†ç”Ÿæ—¥ï¼ˆå¿…å¡«ï¼‰</label>
  <input id="date" type="date"/>

  <div class="row">
    <div>
      <label>å‡ºç”Ÿæ—¶é—´ï¼ˆæœªçŸ¥å¯é€‰â€œæœªçŸ¥â€ï¼‰</label>
      <select id="time">
        <option value="">æœªçŸ¥</option>
        <option>00:00</option><option>01:00</option><option>02:00</option><option>03:00</option>
        <option>04:00</option><option>05:00</option><option>06:00</option><option>07:00</option>
        <option>08:00</option><option>09:00</option><option>10:00</option><option>11:00</option>
        <option>12:00</option><option>13:00</option><option>14:00</option><option>15:00</option>
        <option>16:00</option><option>17:00</option><option>18:00</option><option>19:00</option>
        <option>20:00</option><option>21:00</option><option>22:00</option><option>23:00</option>
      </select>
    </div>
    <div>
      <label>å‡ºç”Ÿåœ°æ—¶åŒºï¼ˆé»˜è®¤UTC+8 é©¬æ¥è¥¿äºš/æ–°åŠ å¡ï¼‰</label>
      <select id="tz">
        <option value="8" selected>UTC+8</option>
        <option value="7">UTC+7</option><option value="9">UTC+9</option>
        <option value="0">UTCÂ±0</option><option value="-5">UTC-5</option><option value="-8">UTC-8</option>
      </select>
    </div>
  </div>

  <div class="row">
    <div>
      <label>æŸ¥çœ‹å“ªä¸€å¹´çš„æµå¹´ï¼ˆé»˜è®¤å½“å‰å¹´ï¼‰</label>
      <input id="flowYear" type="number" min="1900" max="2100"/>
    </div>
    <div>
      <label>è¾“å‡ºè¯­æ°”</label>
      <select id="tone">
        <option value="gentle" selected>æ¸©æŸ”å®‰å®š</option>
        <option value="professional">ä¸“ä¸šç¨³é‡</option>
        <option value="concise">ç®€æ´æ˜å¿«</option>
      </select>
    </div>
  </div>

  <!-- æ•°å­—åˆ†æè¾“å…¥æ¡† -->
  <label style="margin-top:12px">è½¦ç‰Œå·ç ï¼ˆå¯ç•™ç©ºï¼‰</label>
  <input id="car" placeholder="ä¾‹ï¼šABC1234ã€1234 ç­‰"/>

  <label>æ‰‹æœºå·ç ï¼ˆå¯ç•™ç©ºï¼‰</label>
  <input id="phone" placeholder="ä¾‹ï¼š0123456789"/>

  <label>é—¨ç‰Œå·ç ï¼ˆå¯ç•™ç©ºï¼‰</label>
  <input id="house" placeholder="ä¾‹ï¼š25ã€103ã€8"/>

  <div style="margin-top:12px">
    <button onclick="run()">ç”Ÿæˆè§£è¯´</button>
  </div>
</div>

<div class="card">
  <label>å…«å­—æ’ç›˜ï¼ˆå‚è€ƒï¼‰</label>
  <pre id="chart" class="mono" style="white-space:pre-wrap"></pre>
  <div id="tags"></div>
</div>

<div class="card">
  <label>å¯å¤åˆ¶ç»™å‘½ä¸»çš„ WhatsApp æ–‡æ¡ˆï¼ˆæ¸©æŸ”ç‰ˆï¼‰</label>
  <textarea id="wa" rows="20" class="mono"></textarea>
  <div class="row" style="margin-top:10px">
    <button onclick="copyWA()">å¤åˆ¶è§£è¯´</button>
    <button onclick="downloadTxt()">ä¸‹è½½TXT</button>
  </div>
  <p class="muted">æœ¬å·¥å…·ä¸º<strong>å…«å­—äº”è¡Œè§£è¯´</strong>ä¸æµå¹´/æ•°å­—/å–·é›¾é¦™æ°´å‚è€ƒï¼›ä»…ä¾›èº«å¿ƒçµç”¨é€”ã€‚</p>
</div>

<script>
/* â€”â€” æ•°å­—â†’äº”è¡Œ â€”â€” */
const NUM_FIVE = { æœ¨:[3,8], ç«:[2,7], åœŸ:[5,0], é‡‘:[4,9], æ°´:[1,6] };
/* â€”â€” é€šçµç»„åˆï¼ˆå¹¶åˆ—å‚è€ƒï¼‰ â€”â€” */
const NUM_MAGIC = { å‰:['1 è´µäºº','6 é¡º','8 èšè´¢','9 é•¿ä¹…','168 æ—ºè´¢','689 æ—ºè´¢','19 è´µäººå¿«','79 è´µäººå¿«'], å¿Œ:['34 æ˜“å†²','38 ç ´è´¢','78 èµ·ä¼å¤§'] };

/* â€”â€” é¢œè‰² / æ–¹ä½ / è´µäºº â€”â€” */
const COLOR_MAP = {
  æœ¨:['ç»¿è‰²','é’è‰²','ç¿ ç»¿'],
  ç«:['çº¢è‰²','æ©™è‰²','ç´«çº¢'],
  åœŸ:['é»„è‰²','å’–å•¡è‰²','ç±³è‰²','æ£•è‰²'],
  é‡‘:['ç™½è‰²','é‡‘è‰²','é“¶è‰²','ç°'],
  æ°´:['é»‘è‰²','æ·±è“','è—é’']
};
const DIR_MAP = { æœ¨:['ä¸œæ–¹','ä¸œå—'], ç«:['å—æ–¹'], åœŸ:['ä¸œåŒ—','è¥¿å—'], é‡‘:['è¥¿æ–¹','è¥¿åŒ—'], æ°´:['åŒ—æ–¹'] };
const ALLY_ZODIAC = { æœ¨:['è™','å…”'], ç«:['è›‡','é©¬'], åœŸ:['é¾™','ç‰›','ç¾Š','ç‹—'], é‡‘:['çŒ´','é¸¡'], æ°´:['é¼ ','çŒª'] };

/* â€”â€” Julie ä¸“ç”¨æ°´æ™¶ â€”â€” */
const CRYSTALS = {
  é‡‘:['ç™½æ°´æ™¶','ç™½é’›æ™¶','é‡‘å‘æ™¶','ç™½æ°´æ™¶æ™¶ä¸­æ™¶'],
  æœ¨:['ä¸œé™µç‰','ç»¿è‰è“æ™¶','è‘¡è„çŸ³'],
  æ°´:['é»‘æ›œçŸ³','é»‘è‰²ç”µæ°”çŸ³','æµ·è“å®','æœˆå…‰çŸ³','è“è™çœ¼çŸ³'],
  ç«:['å¤ªé˜³çŸ³','å—çº¢ç›ç‘™','çº¢å‘æ™¶'],
  åœŸ:['é»„æ°´æ™¶','è™çœ¼çŸ³','èŒ¶æ™¶','èœœèœ¡']
};
const FEATURE_SET = {
  æŠ¤èº«:['é»‘æ›œçŸ³','é‡‘æ›œçŸ³','é»‘è‰²ç”µæ°”çŸ³','è“è™çœ¼çŸ³','èŒ¶æ™¶'],
  åŒ–ç…:['é»‘æ›œçŸ³','é‡‘æ›œçŸ³','è™çœ¼çŸ³','èŒ¶æ™¶','è“è™çœ¼çŸ³'],
  è´¢è¿:['é»„æ°´æ™¶','é‡‘å‘æ™¶','è™çœ¼çŸ³','ç™½æ°´æ™¶'],
  è´µäºº:['ç™½æ°´æ™¶','ç´«æ°´æ™¶','ç»¿è‰è“æ™¶'],
  äººç¼˜:['ç²‰æ™¶','ç»¿è‰è“æ™¶','æœˆå…‰çŸ³','ç™½æ°´æ™¶'],
  æ„Ÿæƒ…:['ç²‰æ™¶','ç´«æ°´æ™¶','æœˆå…‰çŸ³','è‘¡è„çŸ³'],
  æ¡ƒèŠ±:['ç²‰æ™¶','ç»¿è‰è“æ™¶','ä¸œé™µç‰','ç™½æ°´æ™¶']
};
const CHARMS=['é‡‘è‰²ç¦è¢‹','ç´«æ°´æ™¶é’±è¢‹å­','å¤ªé˜³çŸ³è²”è²…','ä¹¾éš†é€šå®å¤å¸','äº”å¸é’±','ç®—ç›˜','è²èŠ±ç‰Œ'];

/* â€”â€” å–·é›¾é¦™æ°´ï¼šæŒ‰äº”è¡Œçš„â€œå®‰å…¨è°ƒé¦™åº“â€ï¼ˆé¿å…åˆºæ¿€æ€§è¿‡å¼ºçš„çƒ­æ€§ç²¾æ²¹ï¼‰ â€”â€” */
const SPRAY_OILS = {
  æœ¨:['ä½›æ‰‹','ç½—å‹’','å°¤åŠ åˆ©'],
  ç«:['è¿·è¿­é¦™','å§œ'],           // ç«ç³»å°½é‡æ¸©å’Œç”¨é‡
  åœŸ:['å¹¿è—¿é¦™','å²©å…°è‰','é›ªæ¾'],
  é‡‘:['ä¹³é¦™','æª€é¦™','æ²¡è¯'],
  æ°´:['è–°è¡£è‰','ä¾å…°','è“èƒ¶å°¤åŠ åˆ©']
};

/* ç”Ÿæˆ 10 ml å–·é›¾é…æ–¹ï¼š
   - é»˜è®¤ 3%ï¼ˆ6â€“8 æ»´ï¼‰ï¼Œé…’ç²¾ 7 ml + æ°´/çº¯éœ² 2â€“3 ml
   - è‹¥å¼±é¡¹=1ï¼š3+3+2 é…æ¯”
   - è‹¥å¼±é¡¹=2ï¼š4+4ï¼ˆå„ä¸¤æ¬¾ 2+2ï¼‰æˆ– 3+3+2+0
   - è‹¥å¼±é¡¹â‰¥3ï¼šå¹³å‡åˆ†é…åˆ° 8 æ»´
*/
function mkSprayPlan(weakKeys){
  const base = {alcohol:7, water:3}; // ml
  const totalDrops = 8;               // 3% å¼ºåº¦
  const pick = (arr,n)=>arr.slice(0,Math.min(n,arr.length));

  const plan = [];
  if(!weakKeys.length){
    // å‡è¡¡ï¼šåšä¸€æ”¯â€œå®‰å®šé€šç”¨â€
    plan.push(['è–°è¡£è‰',3],['ä¹³é¦™',3],['ä½›æ‰‹',2]);
  }else if(weakKeys.length===1){
    const oils = pick(SPRAY_OILS[weakKeys[0]],3);
    const dist = [3,3,2];
    oils.forEach((o,i)=>plan.push([o,dist[i]||0]));
  }else if(weakKeys.length===2){
    const a=pick(SPRAY_OILS[weakKeys[0]],2), b=pick(SPRAY_OILS[weakKeys[1]],2);
    const dist=[2,2,2,2]; const mix=a.concat(b).slice(0,4);
    mix.forEach((o,i)=>plan.push([o,dist[i]]));
  }else{
    // 3 ä¸ªä»¥ä¸Šï¼šå¹³å‡å‘æ”¾ 2+2+2+1+1â€¦
    const pool = weakKeys.flatMap(k=>pick(SPRAY_OILS[k],2));
    const dist=[2,2,2,1,1,0,0,0];
    pool.slice(0,dist.length).forEach((o,i)=>{ if(dist[i]>0) plan.push([o,dist[i]]);});
    // è‹¥è¿˜æ²¡æ»¡ 8 æ»´ï¼Œç”¨è–°è¡£è‰è¡¥é½
    const used = plan.reduce((s,[_o,d])=>s+d,0);
    if(used<totalDrops) plan.push(['è–°è¡£è‰', totalDrops-used]);
  }

  return {
    title:'å–·é›¾é¦™æ°´ï¼ˆ10ml Â· 3%ï¼‰',
    alcohol:base.alcohol,
    water:base.water,
    drops:totalDrops,
    lines:plan.map(([o,d])=>`${o} ${d}æ»´`)
  };
}

/* å¦å¤–ç»™ä¸¤æ¡£å¯é€‰æµ“åº¦ï¼ˆåŒé…æ¯”ç¼©æ”¾åˆ° 1%/5%ï¼‰ */
function scaleSprayLines(lines, targetDrops){
  // lines: ["è–°è¡£è‰ 3æ»´",...]
  const parse = s=>({name:s.split(' ')[0], n:parseInt(s.match(/(\d+)æ»´/)[1],10)});
  const items = lines.map(parse);
  const total = items.reduce((s,x)=>s+x.n,0) || 1;
  return items.map(x=>{
    const n = Math.max(1, Math.round(x.n/total*targetDrops));
    return `${x.name} ${n}æ»´`;
  });
}

/* â€”â€” å·¥å…· â€”â€” */
function onlyDigits(str){ return (str||'').replace(/\D/g,''); }
function numToFive(str){
  const digits = onlyDigits(str).split('').map(Number);
  if(!digits.length) return null;
  const count={æœ¨:0,ç«:0,åœŸ:0,é‡‘:0,æ°´:0};
  digits.forEach(d=>{ for(const k in NUM_FIVE){ if(NUM_FIVE[k].includes(d)) count[k]++; }});
  return count;
}

/* â€”â€” ä¸»æµç¨‹ â€”â€” */
function run(){
  const name=(document.getElementById('name').value.trim()||'ä½ ');
  const gender=document.getElementById('gender').value;
  const date=document.getElementById('date').value;
  const time=document.getElementById('time').value;
  const tz=parseInt(document.getElementById('tz').value,10)||8;
  const car=document.getElementById('car').value.trim();
  const phone=document.getElementById('phone').value.trim();
  const house=document.getElementById('house').value.trim();
  const enteredYear=(document.getElementById('flowYear').value||'').trim();
  let year=enteredYear?parseInt(enteredYear,10):null;

  if(!date){alert('è¯·å…ˆé€‰æ‹©å…¬å†ç”Ÿæ—¥');return;}
  const loc=new Date(date+'T'+(time||'12:00')+':00');

  const y=loc.getFullYear(), m=loc.getMonth()+1, day=loc.getDate();
  const solar=Solar.fromYmdHms(y,m,day,0,0,0);
  const lunar=solar.getLunar();
  const ec=lunar.getEightChar();
  const yearGZ=ec.getYear(), monthGZ=ec.getMonth(), dayGZ=ec.getDay();
  const timeGZ=(time?ec.getTime():'ï¼ˆæœªçŸ¥ï¼‰');

  if(!year){year=(new Date()).getFullYear();}
  const liuYearGZ=Lunar.fromYmd(year,1,1).getYearInGanZhi();

  // äº”è¡Œè®¡åˆ†ï¼ˆç®€åŒ–ï¼‰
  const G={ç”²:'æœ¨',ä¹™:'æœ¨',ä¸™:'ç«',ä¸:'ç«',æˆŠ:'åœŸ',å·±:'åœŸ',åºš:'é‡‘',è¾›:'é‡‘',å£¬:'æ°´',ç™¸:'æ°´'};
  const Z={å­:'æ°´',ä¸‘:'åœŸ',å¯…:'æœ¨',å¯:'æœ¨',è¾°:'åœŸ',å·³:'ç«',åˆ:'ç«',æœª:'åœŸ',ç”³:'é‡‘',é…‰:'é‡‘',æˆŒ:'åœŸ',äº¥:'æ°´'};
  const sc={é‡‘:0,æœ¨:0,æ°´:0,ç«:0,åœŸ:0};
  [yearGZ,monthGZ,dayGZ,(time?timeGZ:'')].forEach(gz=>{
    if(!gz) return; sc[G[gz[0]]]++; sc[Z[gz[1]]]++; });
  const arr=Object.entries(sc).sort((a,b)=>b[1]-a[1]);
  const max=arr[0][1], min=arr[arr.length-1][1];
  const strong=arr.filter(([k,v])=>v===max).map(x=>x[0]);
  const weak=arr.filter(([k,v])=>v===min).map(x=>x[0]);

  // æ€§æ ¼
  function temperament(){
    const lines=[];
    if(strong.includes('ç«')) lines.push('ç«æ—ºï¼šçƒ­æƒ…å¿«ã€è¡ŒåŠ¨åŠ›å¼ºã€è¡¨è¾¾ç›´æ¥ï¼Œä½†è¦æ³¨æ„æƒ…ç»ªèµ·ä¼ä¸è¿‡åŠ³ã€‚');
    if(strong.includes('é‡‘')) lines.push('é‡‘æ—ºï¼šåŸåˆ™æ„Ÿå¼ºã€é‡æ•ˆç‡ã€åšäº‹åˆ©è½ï¼Œæé†’è‡ªå·±è¯´è¯åˆ«å¤ªç›´ã€‚');
    if(strong.includes('æœ¨')) lines.push('æœ¨æ—ºï¼šæœ‰ç†æƒ³ã€æœ‰è€æ€§ã€é‡äººæƒ…ï¼Œå®¹æ˜“é¡¾å…¨å¤§å±€å´å¿˜äº†è‡ªå·±ã€‚');
    if(strong.includes('æ°´')) lines.push('æ°´æ—ºï¼šæ•æ„Ÿç»†è…»ã€æ´å¯Ÿé«˜ã€ç›´è§‰å¥½ï¼Œæ³¨æ„åˆ«æƒ³å¤ªå¤šã€‚');
    if(strong.includes('åœŸ')) lines.push('åœŸæ—ºï¼šç¨³é‡é è°±ã€èƒ½æ‰›äº‹ã€è€å¿ƒå¥½ï¼Œæé˜²æ‹–å»¶ä¸é¡¾è™‘è¿‡å¤šã€‚');
    if(weak.length){ lines.push(`ç›®å‰åå¼±ï¼š${weak.join('ã€')} â†’ ä¼˜å…ˆè¡¥${weak.join('ã€')}ä¼šæ›´é¡ºã€‚`); }
    return lines.join('\n- ');
  }

  // æ•°å­—åˆ†æ
  function analyseNum(label,value){
    const n = onlyDigits(value);
    if(!n) return null;
    const f = numToFive(value);
    const best = Object.entries(f).sort((a,b)=>b[1]-a[1])[0][0];
    return `- ${label}ï¼ˆ${value}ï¼‰å ${best}`;
  }
  const carInfo = analyseNum('è½¦ç‰Œ',car);
  const phoneInfo = analyseNum('æ‰‹æœº',phone);
  const houseInfo = analyseNum('é—¨ç‰Œ',house);

  // æ•°å­—å»ºè®®
  const suggestDigits = (weak.length? weak.map(w=>NUM_FIVE[w]).flat() : [1,6,4,9]).filter((v,i,a)=>a.indexOf(v)===i);
  const suggestMagic = ['168','689','19','79'];

  // é¢œè‰²/æ–¹ä½/è´µäºº
  function join(arr){return arr.join('ã€');}
  const colorList = weak.length ? join([...(new Set(weak.map(w=>COLOR_MAP[w]).flat()))]) : 'é»‘/ç™½/é‡‘/æ£•ä¸ºä¸»ï¼Œç‚¹ç¼€çº¢/ç»¿æŒ‰å¿ƒæƒ…è°ƒæ•´';
  const carColors = weak.length ? colorList : 'ç™½/é»‘/é‡‘/æ£•ï¼ˆç¨³åœºè€çœ‹ï¼‰';
  const walletColors = (weak.includes('åœŸ')||weak.includes('é‡‘')) ? join([...new Set([...(COLOR_MAP['åœŸ']||[]),...(COLOR_MAP['é‡‘']||[])])]) : 'é‡‘è‰²/æ£•è‰²/é»‘è‰²æ›´ç¨³è´¢';
  const dirs = weak.length ? join([...(new Set(weak.map(w=>DIR_MAP[w]).flat()))]) : 'ä¸œå—/è¥¿åŒ—ä»»é€‰å…¶ä¸€ä¸ºä¸»å‘';
  const allies = weak.length ? join([...(new Set(weak.map(w=>ALLY_ZODIAC[w]).flat()))]) : 'è™ã€å…”ã€çŒ´ã€é¸¡ã€é¼ ã€çŒªï¼ˆæ‹©å…¶ä¸€å³å¯ï¼‰';

  // è‡ªåŠ¨å–·é›¾é…æ–¹
  const spray = mkSprayPlan(weak);
  const spray1 = {title:'å–·é›¾é¦™æ°´ï¼ˆ10ml Â· 1% è½»é¦™ï¼‰', alcohol:7, water:3, drops:3, lines:scaleSprayLines(spray.lines,3)};
  const spray2 = spray; // 3% é»˜è®¤
  const spray3 = {title:'å–·é›¾é¦™æ°´ï¼ˆ10ml Â· 5% æµ“é¦™ï¼‰', alcohol:7.5, water:2, drops:12, lines:scaleSprayLines(spray.lines,12)};

  // é¡¶éƒ¨æ’ç›˜
  const chart=[
    `å¹´æŸ±ï¼š${yearGZ}ã€€æœˆæŸ±ï¼š${monthGZ}ã€€æ—¥æŸ±ï¼š${dayGZ}ã€€æ—¶æŸ±ï¼š${timeGZ}`,
    `äº”è¡Œè®¡åˆ†ï¼ˆç®€åŒ–Â·å†…éƒ¨å‚è€ƒï¼‰ï¼šé‡‘${sc.é‡‘} æœ¨${sc.æœ¨} æ°´${sc.æ°´} ç«${sc.ç«} åœŸ${sc.åœŸ}`,
    `æµå¹´ï¼ˆ${year}ï¼‰ï¼š${liuYearGZ}å¹´`
  ].join('\n');
  document.getElementById('chart').textContent=chart;

  // Header
  const titleText = enteredYear ? `${year}æµå¹´Â·äº”è¡Œè§£è¯´` : `å…«å­—Â·äº”è¡Œè§£è¯´`;

  // æ•°å­—åŒºå—
  let numBlock = `ğŸ”¢ æ•°å­—å‰å‡¶ & å»ºè®®ï¼ˆäº”è¡Œï¼‹é€šçµå¹¶åˆ—å‚è€ƒï¼‰
äº”è¡Œæ•°å­—ï¼šæœ¨3/8ï¼›ç«2/7ï¼›åœŸ5/0ï¼›é‡‘4/9ï¼›æ°´1/6
é€šçµç»„åˆï¼š1è´µäººã€6é¡ºã€8èšè´¢ã€9é•¿ä¹…ï¼›168/689æ—ºè´¢ï¼›19/79è´µäººå¿«
é€‚åˆå‡ºç°çš„æ•°å­—ï¼š${suggestDigits.join('ã€')}
å»ºè®®ç»„åˆï¼š${suggestMagic.join(' / ')}
`;
  if(carInfo||phoneInfo||houseInfo){
    numBlock += `å·²å¡«æ•°å­—çš„å€¾å‘ï¼š
${carInfo||''}
${phoneInfo||''}
${houseInfo||''}
ï¼ˆæ•°å­—åå¼±ä¸ä»£è¡¨ä¸è¡Œï¼›éœ€è¦æ—¶å¯ç”¨æ°´æ™¶/æŒ‚ä»¶/é¢œè‰²æ¥è¡¥ï¼‰`;
  }

  // æ€§æ ¼/é¢œè‰²/æ–¹ä½/è´µäºº
  const personalityBlock = `ğŸ§  æ€§æ ¼ & äº”è¡Œ
- ${temperament() || 'ç»“æ„å¹³è¡¡ï¼šåšäº‹ç¨³ã€æƒ³æ³•æ¸…ï¼Œä¿æŒèŠ‚å¥å³å¯ã€‚'}

ğŸ¨ é¢œè‰²å»ºè®®
- æ—¥å¸¸è‰²ï¼š${colorList}
- è½¦èº«è‰²ï¼š${carColors}
- é’±åŒ…è‰²ï¼š${walletColors}

ğŸ“ æ–¹ä½ & è´µäºº
- æœ‰åˆ©æ–¹ä½ï¼ˆå/é¢å‘ä¼˜å…ˆï¼‰ï¼š${dirs}
- è´µäººç”Ÿè‚–ï¼š${allies}`;

  // æ°´æ™¶ä¸æ¨¡å¼
  const charm1=CHARMS[Math.floor(Math.random()*CHARMS.length)];
  const charm2=CHARMS[Math.floor(Math.random()*CHARMS.length)];
  const crystalBlock = `ğŸ’ æ°´æ™¶ç­–ç•¥
${(weak.length? weak.map(w=>`Â· è¡¥${w}ï¼š${CRYSTALS[w].join(' / ')}`).join('\n') : 'å½“å‰ç»“æ„åå‡è¡¡ï¼Œå¯ç”¨ç™½æ°´æ™¶ï¼‹ç´«æ°´æ™¶åšæ—¥å¸¸ç¨³é¢‘ã€‚')}
å·¦æ‰‹ï¼ˆè´µäºº/è´¢è¿ï¼‰ï¼šè¡¥å¼±ä¸ºä¸»ï¼Œé…ç´«æ°´æ™¶ï¼›å¯åŠ ã€Œ${charm1}ã€
å³æ‰‹ï¼ˆæŠ¤èº«/ç¨³åœºï¼‰ï¼šé»‘æ›œçŸ³/é‡‘æ›œçŸ³/ç”µæ°”çŸ³ï¼›å¯åŠ ã€Œ${charm2}ã€

ğŸ§© å››ç§æ¨¡å¼
â‘  æ—¥å¸¸ï¼šç™½æ°´æ™¶æ‰“åº• + è¡¥å¼±å„1ï½2é¢—
â‘¡ å¼€è¿ï¼šé»„æ°´æ™¶/é‡‘å‘æ™¶/è™çœ¼çŸ³ + ç™½/ç´«æ°´æ™¶ï¼Œé…é’±è¢‹/ç¦è¢‹
â‘¢ çµä¿®ï¼šç™½æ°´æ™¶ + ç´«æ°´æ™¶ï¼ˆä¸­å¿ƒç /é’±è¢‹å­ï¼‰
â‘£ åº”æ€¥ï¼šé»‘æ›œçŸ³/é‡‘æ›œçŸ³/ç”µæ°”çŸ³ + èŒ¶æ™¶ï¼ˆå®Œäº‹æ¢å›æ—¥å¸¸ï¼‰`;

  // è‡ªåŠ¨å–·é›¾é¦™æ°´æ–‡æœ¬
  function sprayLinesText(s){ return `${s.title}
- é…’ç²¾ ${s.alcohol} ml + è’¸é¦æ°´/çº¯éœ² ${s.water} ml
- ç²¾æ²¹å…± ${s.drops} æ»´ï¼š${s.lines.join(' + ')}`; }

  const sprayText = `ğŸŒ¬ å–·é›¾é¦™æ°´ Â· è‡ªåŠ¨é…æ–¹ï¼ˆæŒ‰åå¼±äº”è¡Œç”Ÿæˆï¼‰
${sprayLinesText(spray2)}

å¯é€‰æµ“åº¦ï¼š
${sprayLinesText(spray1)}
${sprayLinesText(spray3)}
ï¼ˆè°ƒé…é¡ºåºï¼šå…ˆæ»´ç²¾æ²¹åˆ°é…’ç²¾ â†’ æ‘‡åŒ€ â†’ å†åŠ æ°´/çº¯éœ² â†’ é™ç½® 24hï½3å¤©æ›´æŸ”å’Œï¼‰`;

  // WhatsApp æ–‡æ¡ˆ
  const wa = [
    `ğŸŒ¿ ${name}${gender?(' Â· '+gender):''}ï½œ${titleText}`,
    ``,
    `å…¬å†ç”Ÿæ—¥ï¼š${y}-${String(m).padStart(2,'0')}-${String(day).padStart(2,'0')} ${time||'æ—¶é—´æœªçŸ¥'}ï¼ˆUTC${tz>=0?'+':''}${tz}ï¼‰`,
    `äº”è¡Œè®¡åˆ†ï¼šé‡‘${sc.é‡‘} æœ¨${sc.æœ¨} æ°´${sc.æ°´} ç«${sc.ç«} åœŸ${sc.åœŸ}`,
    `åæ—ºï¼š${strong.join('/')||'â€”'}ã€€åå¼±ï¼š${weak.join('/')||'â€”'}`,
    ``,
    numBlock,
    ``,
    personalityBlock,
    ``,
    crystalBlock,
    ``,
    sprayText,
    ``,
    `ğŸ”– æŒ‚ä»¶ï¼šé’±è¢‹/ç¦è¢‹/äº”å¸é’±/è²”è²…/å¤å¸/è²èŠ±ç‰Œ/ç®—ç›˜`,
    ``,
    `ğŸ’¬ æ¸©æŸ”ç»“è¯­
æ•°å­—ã€é¢œè‰²ã€æ–¹ä½ã€æ°´æ™¶ã€é¦™æ°´éƒ½æ˜¯å¸®ä½ â€œç¨³ä½è‡ªå·±â€çš„å·¥å…·ã€‚ä¿æŒèŠ‚å¥ã€æœºä¼šè‡ªç„¶æ¥ã€‚`
  ].join('\n');

  document.getElementById('wa').value = wa;

  // é¡¶éƒ¨æ ‡ç­¾
  document.getElementById('tags').innerHTML =
    `<span class="pill">åæ—ºï¼š${strong.join('/')||'â€”'}</span>
     <span class="pill">åå¼±ï¼š${weak.join('/')||'â€”'}</span>
     <span class="pill">æ•°å­—/é¢œè‰²/æ–¹ä½/å–·é›¾å·²å¯ç”¨</span>`;
}

/* â€”â€” è¾…åŠ©æŒ‰é’® â€”â€” */
function copyWA(){ const el=document.getElementById('wa'); el.select(); el.setSelectionRange(0,99999); document.execCommand('copy'); alert('å·²å¤åˆ¶ï¼Œå¯ä»¥ç›´æ¥è´´åˆ° WhatsAppã€‚'); }
function downloadTxt(){ const blob=new Blob([document.getElementById('wa').value],{type:'text/plain;charset=utf-8'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='bazi_wa.txt'; a.click(); }
</script>
</body>
</html>
